!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("firebase"),require("@angular/common/http"),require("rxjs/Subject"),require("rxjs/observable/fromPromise"),require("@angular/common"),require("rxjs/BehaviorSubject"),require("@angular/platform-browser"),require("rxjs/add/operator/map"),require("rxjs/add/operator/do"),require("firebase/firestore")):"function"==typeof define&&define.amd?define("angularfire-lite",["exports","@angular/core","firebase","@angular/common/http","rxjs/Subject","rxjs/observable/fromPromise","@angular/common","rxjs/BehaviorSubject","@angular/platform-browser","rxjs/add/operator/map","rxjs/add/operator/do","firebase/firestore"],e):e(t["angularfire-lite"]={},t.ng.core,t.firebase,t.ng.common.http,t.Rx,t.Rx.Observable,t.ng.common,t.Rx,t.ng.platformBrowser)}(this,function(t,e,r,o,a,u,p,d,l){"use strict";function i(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,i,n=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(o=n.next()).done;)s.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(i)throw i.error}}return s}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}var n=function(){function t(t){this.appConfig=t}return t.prototype.instance=function(){return r.apps.length?r.app():r.initializeApp(this.appConfig)},t.prototype.config=function(){return this.appConfig},t}();n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:w}]};var s=function(){function t(t,e,r){this.app=t,this.http=e,this.platformId=r,this.browser=p.isPlatformBrowser(this.platformId),this.server=p.isPlatformServer(this.platformId),this.auth=t.instance().auth(),this.config=t.config()}return t.prototype.uid=function(){var e=this,r=new a.Subject;return this.isAuthenticated().subscribe(function(t){t?e.auth.onAuthStateChanged(function(t){r.next(t.uid)}):r.next(null)}),r},t.prototype.isAuthenticated=function(){var e=new a.Subject;return this.auth.onAuthStateChanged(function(t){e.next(!!t)}),e},t.prototype.isAnonymous=function(){var e=new a.Subject;return this.auth.onAuthStateChanged(function(t){e.next(t.isAnonymous)}),e},t.prototype.currentUser=function(){var t=new a.Subject;return t.next(this.auth.currentUser),t},t.prototype.userData=function(){var e=this;if(this.server)return u.fromPromise(this.auth.currentUser.getIdToken(!0).then(function(t){return e.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/getAccountInfo?key="+e.config.apiKey,{idToken:t})}));if(this.browser){var r=new a.Subject;return this.auth.onAuthStateChanged(function(t){t&&r.next({displayName:t.displayName,email:t.email,emailVerified:t.emailVerified,photoURL:t.photoURL,isAnonymous:t.isAnonymous,uid:t.uid,providerData:t.providerData,phoneNumber:t.phoneNumber})}),r}},t.prototype.providers=function(t){if(this.server)return this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/createAuthUri?key="+this.config.apiKey,{identifier:t});if(this.browser){var e=new a.Subject;return this.auth.fetchProvidersForEmail(t).then(function(t){e.next(t)}),e}},t.prototype.signin=function(t,e){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key="+this.config.apiKey,{email:t,password:e,returnSecureToken:!0}):this.browser?u.fromPromise(this.auth.signInWithEmailAndPassword(t,e)):void 0},t.prototype.signinAnonymously=function(){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key="+this.config.apiKey,{returnSecureToken:!0}):this.browser?u.fromPromise(this.auth.signInAnonymously()):void 0},t.prototype.signup=function(t,e){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key="+this.config.apiKey,{email:t,password:e,returnSecureToken:!0}):this.browser?u.fromPromise(this.auth.createUserWithEmailAndPassword(t,e)):void 0},t.prototype.signout=function(){return u.fromPromise(this.auth.signOut())},t.prototype.updateProfile=function(e){var r,o=this;return this.server?(null===e.displayName&&null===e.photoURL?r="'PHOTO_URL' , 'DISPLAY_NAME'":null===e.displayName?r="DISPLAY_NAME":null===e.photoURL&&(r="PHOTO_URL"),this.auth.currentUser.getIdToken(!0).then(function(t){return o.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/setAccountInfo?key="+o.config.apiKey,{idToken:t,displayName:e.displayName,photoUrl:e.photoURL,deleteAttribute:r,returnSecureToken:!0})})):this.browser?u.fromPromise(this.auth.currentUser.updateProfile(e)):void 0},t.prototype.updateEmail=function(e){var r=this;return this.server?this.auth.currentUser.getIdToken(!0).then(function(t){return r.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/setAccountInfo?key="+r.config.apiKey,{idToken:t,email:e,returnSecureToken:!0})}):this.browser?u.fromPromise(this.auth.currentUser.updateEmail(e)):void 0},t.prototype.updatePassword=function(e){var r=this;return this.server?this.auth.currentUser.getIdToken(!0).then(function(t){return r.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/setAccountInfo?key="+r.config.apiKey,{idToken:t,password:e,returnSecureToken:!0})}):this.browser?u.fromPromise(this.auth.currentUser.updatePassword(e)):void 0},t.prototype.verifyPasswordResetCode=function(t){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/resetPassword?key="+this.config.apiKey,{oobCode:t}):this.browser?u.fromPromise(this.auth.verifyPasswordResetCode(t)):void 0},t.prototype.confirmPasswordReset=function(t,e){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/resetPassword?key="+this.config.apiKey,{oobCode:t,newPassword:e}):this.browser?u.fromPromise(this.auth.confirmPasswordReset(t,e)):void 0},t.prototype.relogin=function(t){return u.fromPromise(this.auth.currentUser.reauthenticateWithCredential(t))},t.prototype.deletePermanently=function(){var e=this;return this.server?u.fromPromise(this.auth.currentUser.getIdToken(!0).then(function(t){return e.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/deleteAccount?key="+e.config.apiKey,{idToken:t})})):this.browser?u.fromPromise(this.auth.currentUser["delete"]()):void 0},t.prototype.sendEmailVerification=function(){var e=this;return this.server?u.fromPromise(this.auth.currentUser.getIdToken(!0).then(function(t){return e.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/getOobConfirmationCode?key="+e.config.apiKey,{requestType:"VERIFY_EMAIL",idToken:t})})):this.browser?u.fromPromise(this.auth.currentUser.sendEmailVerification()):void 0},t.prototype.sendPasswordResetEmail=function(t){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/getOobConfirmationCode?key="+this.config.apiKey,{requestType:"PASSWORD_RESET",email:t}):this.browser?u.fromPromise(this.auth.sendPasswordResetEmail(t)):void 0},t}();s.decorators=[{type:e.Injectable}],s.ctorParameters=function(){return[{type:n},{type:o.HttpClient},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var c=function(){function t(t,e,r,o){var i=this;this.app=t,this.http=e,this.state=r,this.platformId=o,this.server=p.isPlatformServer(this.platformId),this.browser=p.isPlatformBrowser(this.platformId),this.ref=function(t){return i.database.ref(t)},this.database=t.instance().database(),this.config=t.config()}return t.prototype.read=function(t){var e=l.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"value",e):void 0},t.prototype.childAdded=function(t){var e=l.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_added",e):void 0},t.prototype.childChanged=function(t){var e=l.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_changed",e):void 0},t.prototype.childRemoved=function(t){var e=l.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_removed",e):void 0},t.prototype.childMoved=function(t){var e=l.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_moved",e):void 0},t.prototype.SRH=function(t,r){var o=this;return this.http.get("https://"+this.config.projectId+".firebaseio.com/"+t+".json").map(function(e){if(e&&"object"==typeof e){var t=Object.keys(e).map(function(t){return[e[t]]});return o.state.set(r,t),t}return o.state.set(r,e),e})},t.prototype.BRH=function(t,e,r){if(this.browser){var o=this.state.get(r,[]),i=new d.BehaviorSubject(o);return this.ref(t).on(e,function(e){if(e.val()&&"object"==typeof e.val()){var t=Object.keys(e.val()).map(function(t){return[e.val()[t]]});i.next(t)}else i.next(e.val())}),i}},t.prototype.write=function(t,e){return this.server?this.http.put("https://"+this.config.projectId+".firebaseio.com/"+t+".json?print=silent",e):this.browser?u.fromPromise(this.ref(t).set(e)):void 0},t.prototype.push=function(t,e){return this.server?this.http.post("https://"+this.config.projectId+".firebaseio.com/"+t+".json?print=silent",e):this.browser?u.fromPromise(this.ref(t).push(e)):void 0},t.prototype.update=function(t,e){return this.server?this.http.patch("https://"+this.config.projectId+".firebaseio.com/"+t+".json?print=silent",e):this.browser?u.fromPromise(this.ref(t).update(e)):void 0},t.prototype.remove=function(t){return this.server?this.http["delete"]("https://"+this.config.projectId+".firebaseio.com/"+t+".json"):this.browser?u.fromPromise(this.ref(t).remove()):void 0},t.prototype.query=function(i){var n=this.platformId,s=this.state,e=this.database,o=this.http,a=this.config,u=function(t,e,r){return o.get("https://"+a.projectId+".firebaseio.com/"+t+".json?"+e).map(function(e){if(e&&"object"==typeof e){var t=Object.keys(e).map(function(t){return[e[t]]});return s.set(r,t),t}return s.set(r,e),e})},c=function(r){return function(e){if(e.val()&&"object"==typeof e.val()){var t=Object.keys(e.val()).map(function(t){return[e.val()[t]]});r.next(t)}else r.next(e.val())}},f="",h=this.ref(i);return{startAt:function(t){return f+="&startAt="+t,h=h.startAt(t),this},endAt:function(t){return f+="&endAt="+t,h=h.endAt(t),this},equalTo:function(t){return f+="&equalTo="+t,h=h.equalTo(t),this},isEqual:function(t){if(p.isPlatformBrowser(n))return e.ref(i).isEqual(t)},limitToFirst:function(t){return f+="&limitToFirst="+t,h=h.limitToFirst(t),this},limitToLast:function(t){return f+="&limitToLast="+t,h=h.limitToLast(t),this},orderByChild:function(t){return f+='&orderBy="'+t+'"',h=h.orderByChild(t),this},orderByKey:function(){return f+='&orderBy="$key"',h=h.orderByKey(),this},orderByPriority:function(){return f+='&orderBy="$priority"',h=h.orderByPriority(),this},orderByValue:function(){return f+='&orderBy="$value"',h=h.orderByValue(),this},on:function(t){var e=l.makeStateKey(i);if(p.isPlatformServer(n))return u(i,f,e);if(p.isPlatformBrowser(n)){var r=s.get(e,[]),o=new d.BehaviorSubject(r);return h.on(t,c(o)),o}},once:function(t){var e=l.makeStateKey(i);if(p.isPlatformServer(n))return u(i,f,e);if(p.isPlatformBrowser(n)){var r=s.get(e,[]),o=new d.BehaviorSubject(r);return h.once(t,c(o)),o}}}},t}();c.decorators=[{type:e.Injectable}],c.ctorParameters=function(){return[{type:n},{type:o.HttpClient},{type:l.TransferState},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var f=function(){function t(t,e,r,o){this.app=t,this.http=e,this.state=r,this.platformId=o,this.browser=p.isPlatformBrowser(this.platformId),this.firestore=t.instance().firestore(),this.config=t.config()}return t.prototype.read=function(t){var e=this,r=l.makeStateKey(t),o=t.split("/");"/"===o[0]&&o.shift(),"/"===o[o.length-1]&&o.pop();var i=o.length-1;if(p.isPlatformServer(this.platformId))return this.http.get("https://firestore.googleapis.com/v1beta1/projects/"+this.config.projectId+"/databases/(default)/documents/"+t).map(function(r){var o={};if(i%2!=0)return Object.keys(r.fields).forEach(function(t){for(var e in r.fields[t])e&&(o[t]=r.fields[t][e])}),o;var t=[];return r.documents.forEach(function(r){var o={};Object.keys(r.fields).forEach(function(t){for(var e in r.fields[t])e&&(o[t]=r.fields[t][e])}),t.push(o)}),t})["do"](function(t){e.state.set(r,t)});if(this.browser){var n=[],s=this.state.get(r,[]),a=new d.BehaviorSubject(s);return i%2==0?this.firestore.collection(t).onSnapshot(function(t){t.docs.forEach(function(t){n.push(t.data())}),a.next(n)}):this.firestore.doc(t).onSnapshot(function(t){a.next(t.data())}),a}},t.prototype.write=function(t,e,r){if(this.browser)return u.fromPromise(this.firestore.doc(t).set(e,{merge:r}))},t.prototype.push=function(t,e){if(this.browser)return u.fromPromise(this.firestore.collection(t).add(e))},t.prototype.update=function(t,e){if(this.browser)return u.fromPromise(this.firestore.doc(t).update(e))},t.prototype.remove=function(t){return p.isPlatformServer(this.platformId)?this.http["delete"]("https://firestore.googleapis.com/v1beta1/projects/"+this.config.projectId+"/databases/(default)/documents/"+t):this.browser?u.fromPromise(this.firestore.doc(t)["delete"]()):void 0},t.prototype.removeField=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(this.browser)return u.fromPromise(this.firestore.doc(t).update(e))},t.prototype.removeCollection=function(t){var e=this;if(this.browser)return u.fromPromise(this.firestore.collection(t).get().then(function(t){t.docs.forEach(function(t){e.firestore.batch()["delete"](t.ref)})}))},t.prototype.query=function(i){var n=this.platformId,t=this.http,r=this.config,s=this.state,e=this.firestore,a={from:[{collectionId:""+i}]},u=function(e){var a=[];return t.post("https://firestore.googleapis.com/v1beta1/projects/"+r.projectId+"/databases/(default)/documents:runQuery",o).map(function(t){var e,r,o=function(r){var o={};Object.keys(r.document.fields).forEach(function(t){var e=Object.keys(r.document.fields[t]);o[t]=r.document.fields[t][e[0]]}),a.push(o)};try{for(var i=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}(t),n=i.next();!n.done;n=i.next()){o(n.value)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(e)throw e.error}}return a})["do"](function(t){s.set(e,t)})},o={structuredQuery:a},c=[],f=e.collection(i);return{where:function(t,e,r){var o="";switch(e){case"<":o="LESS_THAN";break;case"<=":o="LESS_THAN_OR_EQUAL";break;case">":o="GREATER_THAN";break;case">=":o="GREATER_THAN_OR_EQUAL";break;case"==":o="EQUAL"}return a.where={},a.where.fieldFilter={},a.where.fieldFilter.field={},a.where.fieldFilter.field.fieldPath=i,a.where.fieldFilter.op=o,a.where.fieldFilter.value=m(r),f=f.where(t,e,r),this},startAt:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(m(t))}),a.startAt={},a.startAt.before=!0,a.startAt.values=r,f=f.startAt.apply(f,h(t)),this},startAfter:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(m(t))}),a.startAt={},a.startAt.before=!1,a.startAt.values=r,f=f.startAfter.apply(f,h(t)),this},endAt:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(m(t))}),a.endAt={},a.endAt.before=!1,a.endAt.values=r,f=f.endAt.apply(f,h(t)),this},endBefore:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(m(t))}),a.endAt={},a.endAt.before=!0,a.endAt.values=r,f=f.endBefore.apply(f,h(t)),this},limit:function(t){return a.limit=t,f=f.limit(t),this},orderBy:function(t,e){var r={field:{fieldPath:""}};switch(r.field.fieldPath=t,e){case"asc":r.direction="ASCENDING";break;case"desc":r.direction="DESCENDING"}return c.push(r),f=f.orderBy(t,e),a.orderBy=c,this},on:function(){var t=l.makeStateKey(i+":query");if(p.isPlatformServer(n))return u(t);if(p.isPlatformBrowser(n)){var e=s.get(t,[]),r=new d.BehaviorSubject(e);return f.onSnapshot(function(t){var e=[];t.forEach(function(t){e.push(t.data())}),r.next(e)}),r}},get:function(){var t=l.makeStateKey(i+":query");if(p.isPlatformServer(n))return u(t);if(p.isPlatformBrowser(n)){var e=[],r=s.get(t,[]),o=new d.BehaviorSubject(r);return f.get().then(function(t){t.forEach(function(t){e.push(t)}),o.next(e)}),o}}}},t.prototype.transaction=function(){if(this.browser){var o,r=this.firestore,i=0,n=function(t){return r.doc(t).get()},s=function(t,e){return r.doc(t).set(e)};return{set:function(t,e){return o=o.then(function(){s(t,e)}),this},get:function(t){var e=this,r=new a.Subject;return 0<i?o=o.then(function(){n(t).then(function(t){r.next({data:t.data(),next:e})})}):0===i&&(o=n(t).then(function(t){r.next({data:t.data(),next:e})})),i++,r},run:function(){return u.fromPromise(r.runTransaction(function(){return o}))}}}console.log("transactions SSR is not supported yet")},t.prototype.batch=function(){if(this.browser){var r=this.firestore,o=this.firestore.batch();return{set:function(t,e){return o.set(r.doc(t),e),this},update:function(t,e){return o.update(r.doc(t),e),this},"delete":function(t){return o["delete"](r.doc(t)),this},commit:function(){return u.fromPromise(o.commit())}}}console.log("batched writes SSR is not supported yet")},t}();function m(t){switch(t){case"boolean"==typeof t:return{booleanValue:t};case"string"==typeof t:return{stringValue:t};case"number"==typeof t:return{doubleValue:t};case"object"==typeof t&&t:return{arrayValue:t}}}f.decorators=[{type:e.Injectable}],f.ctorParameters=function(){return[{type:n},{type:o.HttpClient},{type:l.TransferState},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var y=function(){function t(t,e){this.app=t,this.platformId=e,this.browser=p.isPlatformBrowser(this.platformId),this.storage=t.instance().storage()}return t.prototype.upload=function(t,e,r){if(this.browser)return u.fromPromise(this.child(t).put(e,r))},t.prototype.uploadString=function(t,e){if(this.browser)return u.fromPromise(this.child(t).putString(e))},t.prototype.download=function(t){if(this.browser)return u.fromPromise(this.child(t).getDownloadURL())},t.prototype.remove=function(t){if(this.browser)return u.fromPromise(this.child(t)["delete"]())},t.prototype.getMetadata=function(t){if(this.browser){var e=new a.Subject;return this.child(t).getMetadata().then(function(t){e.next(t)}),e}},t.prototype.updateMetadata=function(t,e){if(this.browser)return u.fromPromise(this.child(t).updateMetadata(e))},t.prototype.deleteMetadata=function(t){if(this.browser)return u.fromPromise(this.child(t).updateMetadata({customMetadata:null,cacheControl:null,contentEncoding:null,contentLanguage:null,contentType:null}))},t.prototype.child=function(t){return this.storage.ref().child(t)},t}();y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[{type:n},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var v=function(){function t(t,e){this.app=t,this.platformId=e,this.browser=p.isPlatformBrowser(this.platformId),this.messaging=t.instance().messaging()}return t.prototype.instance=function(){if(this.browser)return this.messaging},t.prototype.token=function(){if(this.browser)return u.fromPromise(this.messaging.getToken())},t.prototype.tokenRefresh=function(){var t=this;if(this.browser){var e=new a.Subject;return this.messaging.onMessage(function(){t.messaging.getToken().then(function(t){e.next(t)})}),e}},t.prototype.requestPermission=function(){if(this.browser)return u.fromPromise(this.messaging.requestPermission())},t.prototype.deleteToken=function(t){if(this.browser)return u.fromPromise(this.messaging.deleteToken(t))},t}();function g(t){return new n(t)}v.decorators=[{type:e.Injectable}],v.ctorParameters=function(){return[{type:n},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var w=function(){},b=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:w,useValue:t},{provide:n,useFactory:g,deps:[w]},c,s,f,y,v]}},e}();b.decorators=[{type:e.NgModule,args:[{imports:[o.HttpClientModule,p.CommonModule,l.BrowserTransferStateModule]}]}],t.AngularFireLiteAppFactory=g,t.FirebaseAppConfig=w,t.AngularFireLite=b,t.AngularFireLiteApp=n,t.AngularFireLiteDatabase=c,t.AngularFireLiteStorage=y,t.AngularFireLiteMessaging=v,t.AngularFireLiteFirestore=f,t.FormatServerData=m,t.AngularFireLiteAuth=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angularfire-lite.umd.min.js.map
